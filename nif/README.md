**TODO** - Need to tidy this up so that we can use the system's Erlang distribution.

Copied from erlang 20.2
